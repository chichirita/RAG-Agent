<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>PolarAgency ‚Äî –í–∞—à –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Ç–Ω—ë—Ä</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="logo">üåê PolarAgency</div>
        <nav>
            <a href="#">–û –∫–æ–º–ø–∞–Ω–∏–∏</a>
            <a href="#">–£—Å–ª—É–≥–∏</a>
            <a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </nav>
    </header>

    <section class="hero">
        <h1>PolarAgency</h1>
        <p>–ù–∞–¥—ë–∂–Ω—ã–µ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞.</p>
    </section>

    <button id="chat-toggle">üí¨ –ß–∞—Ç</button>

    <div class="middle-container"></div>

    <div id="chat-widget" class="chat-container">
        <div class="chat-header">
            <span>–ß–∞—Ç PolarAgency</span>
            <button id="close-chat">‚úñÔ∏è</button>
        </div>
        <div id="chat-box">
        </div>
        <div class="input-container">
            <input id="user-input" type="text" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å..." autofocus>
            <button id="send-btn">‚û§</button>
        </div>
    </div>

    <footer>
        ¬© 2025 PolarAgency. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
    </footer>

    <script>
        const chatBox = document.getElementById("chat-box");
        const input = document.getElementById("user-input");
        const btn = document.getElementById("send-btn");
        const chatWidget = document.getElementById("chat-widget");
        const toggleBtn = document.getElementById("chat-toggle");
        const closeBtn = document.getElementById("close-chat");

        toggleBtn.onclick = () => {
            chatWidget.style.display = "flex";
            toggleBtn.style.display = "none";

            if (!chatBox.dataset.started) {
                addMessage("–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –Ø –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –ò–ò PolarAgency. –ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫ –º–æ–≥—É –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?", "bot");
                chatBox.dataset.started = "true";
            }
        };

        closeBtn.onclick = () => {
            chatWidget.style.display = "none";
            toggleBtn.style.display = "block";
        };

        function addMessage(text, cls) {
            const div = document.createElement("div");
            div.className = "message " + cls;
            div.textContent = text;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
            return div;
        }

        async function sendMessage() {
            const message = input.value;
            if (!message) return;
            addMessage(message, "user");
            input.value = "";


            const typingIndicator = addMessage("–ú–µ–Ω–µ–¥–∂–µ—Ä –Ω–∞–±–∏—Ä–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ...", "typing");

            const response = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: "message=" + encodeURIComponent(message)
            });

            const reader = response.body.getReader();

            // —Å–æ–∑–¥–∞—ë–º –±–ª–æ–∫ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞
            const botMsg = document.createElement("div");
            botMsg.className = "message bot";

            // —É–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –±–ª–æ–∫ –æ—Ç–≤–µ—Ç–∞
            chatBox.removeChild(typingIndicator);
            chatBox.appendChild(botMsg);

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                botMsg.textContent += new TextDecoder().decode(value);
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        btn.onclick = sendMessage;
        input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>


</body>
</html>